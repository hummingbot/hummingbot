{"version":3,"sources":["../../src/bootstrap/index.ts"],"names":["tracer","bootstrap","initialContext","spanArgs","parentSpan","childOf","startSpan","bootstrapContext","context","gatsbyNodeGraphQLFunction","store","reporter","finish","workerPool"],"mappings":";;;;;;;AAAA;;AACA;;AAaA;;AACA;;AACA;;AAEA;;AAEA,MAAMA,MAAM,GAAG,gCAAf;;AAEO,eAAeC,SAAf,CACLC,cADK,EAKJ;AACD,QAAMC,QAAQ,GAAGD,cAAc,CAACE,UAAf,GACb;AAAEC,IAAAA,OAAO,EAAEH,cAAc,CAACE;AAA1B,GADa,GAEb,EAFJ;AAIA,QAAMA,UAAU,GAAGJ,MAAM,CAACM,SAAP,CAAkB,WAAlB,EAA8BH,QAA9B,CAAnB;AAEA,QAAMI,gBAA+B,GAAG,EACtC,GAAGL,cADmC;AAEtCE,IAAAA;AAFsC,GAAxC;AAKA,QAAMI,OAAO,GAAG,EACd,GAAGD,gBADW;AAEd,QAAI,MAAM,0BAAWA,gBAAX,CAAV;AAFc,GAAhB;AAKA,QAAM,+BAAgBC,OAAhB,CAAN;AACA,QAAM,2BAAYA,OAAZ,CAAN;AAEA,QAAM,2BAAYA,OAAZ,CAAN;AAEAA,EAAAA,OAAO,CAACC,yBAAR,GAAoC,8CAClCD,OAAO,CAACE,KAD0B,EAElCC,iBAFkC,CAApC;AAKA,QAAM,2BAAYH,OAAZ,CAAN;AAEA,QAAM,qCAAsBA,OAAtB,CAAN;AAEA,QAAM,oCAAN;AAEA,QAAM,yCAA0BA,OAA1B,CAAN;AAEA,QAAM,8BAAeA,OAAf,CAAN;AAEA,QAAM,iCAAkBA,OAAlB,CAAN;AAEA;AAEA,QAAM,6BAAcA,OAAd,CAAN;AAEAJ,EAAAA,UAAU,CAACQ,MAAX;AAEA,SAAO;AACLH,IAAAA,yBAAyB,EAAED,OAAO,CAACC,yBAD9B;AAELI,IAAAA,UAAU,EAAEL,OAAO,CAACK;AAFf,GAAP;AAID","sourcesContent":["import { startRedirectListener } from \"./redirects-writer\"\nimport {\n  IBuildContext,\n  initialize,\n  customizeSchema,\n  sourceNodes,\n  buildSchema,\n  createPages,\n  createPagesStatefully,\n  extractQueries,\n  writeOutRedirects,\n  postBootstrap,\n  rebuildSchemaWithSitePage,\n} from \"../services\"\nimport { Runner, createGraphQLRunner } from \"./create-graphql-runner\"\nimport reporter from \"gatsby-cli/lib/reporter\"\nimport { globalTracer } from \"opentracing\"\nimport JestWorker from \"jest-worker\"\nimport { handleStalePageData } from \"../utils/page-data\"\n\nconst tracer = globalTracer()\n\nexport async function bootstrap(\n  initialContext: Partial<IBuildContext>\n): Promise<{\n  gatsbyNodeGraphQLFunction: Runner\n  workerPool: JestWorker\n}> {\n  const spanArgs = initialContext.parentSpan\n    ? { childOf: initialContext.parentSpan }\n    : {}\n\n  const parentSpan = tracer.startSpan(`bootstrap`, spanArgs)\n\n  const bootstrapContext: IBuildContext = {\n    ...initialContext,\n    parentSpan,\n  }\n\n  const context = {\n    ...bootstrapContext,\n    ...(await initialize(bootstrapContext)),\n  }\n\n  await customizeSchema(context)\n  await sourceNodes(context)\n\n  await buildSchema(context)\n\n  context.gatsbyNodeGraphQLFunction = createGraphQLRunner(\n    context.store,\n    reporter\n  )\n\n  await createPages(context)\n\n  await createPagesStatefully(context)\n\n  await handleStalePageData()\n\n  await rebuildSchemaWithSitePage(context)\n\n  await extractQueries(context)\n\n  await writeOutRedirects(context)\n\n  startRedirectListener()\n\n  await postBootstrap(context)\n\n  parentSpan.finish()\n\n  return {\n    gatsbyNodeGraphQLFunction: context.gatsbyNodeGraphQLFunction,\n    workerPool: context.workerPool,\n  }\n}\n"],"file":"index.js"}