{"version":3,"sources":["../../src/bootstrap/remove-stale-jobs.ts"],"names":["removeStaleJobs","state","actions","jobsV2","complete","forEach","job","contentDigest","push","internalActions","removeStaleJob","incomplete","plugin","publicActions","createJobV2"],"mappings":";;;;;AAOA;;AACA;;AAEO,MAAMA,eAAe,GAC1BC,KAD6B,IAEI;AACjC,QAAMC,OAAqC,GAAG,EAA9C,CADiC,CAGjC;;AACAD,EAAAA,KAAK,CAACE,MAAN,CAAaC,QAAb,CAAsBC,OAAtB,CACE,CAACC,GAAD,EAA4BC,aAA5B,KAA4D;AAC1D,QAAI,6BAAWD,GAAX,CAAJ,EAAqB;AACnBJ,MAAAA,OAAO,CAACM,IAAR,CAAaC,yBAAgBC,cAAhB,CAA+BH,aAA/B,CAAb;AACD;AACF,GALH,EAJiC,CAYjC;AACA;;AACAN,EAAAA,KAAK,CAACE,MAAN,CAAaQ,UAAb,CAAwBN,OAAxB,CACE,CAAC;AAAEC,IAAAA,GAAF;AAAOM,IAAAA;AAAP,GAAD,KAAmD;AACjD,QAAI,6BAAWN,GAAX,CAAJ,EAAqB;AACnBJ,MAAAA,OAAO,CAACM,IAAR,CAAaC,yBAAgBC,cAAhB,CAA+BJ,GAAG,CAACC,aAAnC,CAAb;AACD,KAFD,MAEO;AACLL,MAAAA,OAAO,CAACM,IAAR,CAAaK,uBAAcC,WAAd,CAA0BR,GAA1B,EAA+BM,MAA/B,CAAb;AACD;AACF,GAPH;AAUA,SAAOV,OAAP;AACD,CA3BM","sourcesContent":["import {\n  IGatsbyState,\n  IRemoveStaleJobAction,\n  IGatsbyIncompleteJobV2,\n  IGatsbyCompleteJobV2,\n} from \"../redux/types\"\n\nimport { isJobStale } from \"../utils/jobs-manager\"\nimport { publicActions, internalActions } from \"../redux/actions\"\n\nexport const removeStaleJobs = (\n  state: IGatsbyState\n): Array<IRemoveStaleJobAction> => {\n  const actions: Array<IRemoveStaleJobAction> = []\n\n  // If any of our finished jobs are stale we remove them to keep our cache small\n  state.jobsV2.complete.forEach(\n    (job: IGatsbyCompleteJobV2, contentDigest: string): void => {\n      if (isJobStale(job)) {\n        actions.push(internalActions.removeStaleJob(contentDigest))\n      }\n    }\n  )\n\n  // If any of our pending jobs do not have an existing inputPath or the inputPath changed\n  // we remove it from the queue as they would fail anyway\n  state.jobsV2.incomplete.forEach(\n    ({ job, plugin }: IGatsbyIncompleteJobV2): void => {\n      if (isJobStale(job)) {\n        actions.push(internalActions.removeStaleJob(job.contentDigest))\n      } else {\n        actions.push(publicActions.createJobV2(job, plugin))\n      }\n    }\n  )\n\n  return actions\n}\n"],"file":"remove-stale-jobs.js"}